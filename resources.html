<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Resources - HackMate</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="javascript:history.back()" class="btn btn-ghost" style="padding: 0.5rem;">
                    <i data-lucide="arrow-left"></i>
                </a>
                <h1 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Team Resources</h1>
                <span id="team-badge" class="badge">Loading...</span>
            </div>
            <div class="nav-actions">
                <button class="btn btn-primary" onclick="showAddResourceModal()">
                    <i data-lucide="plus"></i>
                    Add Resource
                </button>
                <button class="btn btn-ghost" onclick="logout()">
                    <i data-lucide="log-out"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container" style="padding: 1.5rem;">
        <!-- Resource Categories -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <div class="card" style="padding: 1.5rem; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="links-count">0</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground);">Links & References</div>
            </div>
            <div class="card" style="padding: 1.5rem; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: #10B981; margin-bottom: 0.5rem;" id="documents-count">0</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground);">Documents</div>
            </div>
            <div class="card" style="padding: 1.5rem; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: #F59E0B; margin-bottom: 0.5rem;" id="tools-count">0</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground);">Tools & APIs</div>
            </div>
            <div class="card" style="padding: 1.5rem; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: #8B5CF6; margin-bottom: 0.5rem;" id="media-count">0</div>
                <div style="font-size: 0.875rem; color: var(--muted-foreground);">Media & Assets</div>
            </div>
        </div>

        <!-- Resource Filters -->
        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <button class="btn btn-outline filter-btn active" data-filter="all">All Resources</button>
            <button class="btn btn-outline filter-btn" data-filter="link">Links</button>
            <button class="btn btn-outline filter-btn" data-filter="document">Documents</button>
            <button class="btn btn-outline filter-btn" data-filter="tool">Tools</button>
            <button class="btn btn-outline filter-btn" data-filter="media">Media</button>
        </div>

        <!-- Resources Grid -->
        <div id="resources-grid" style="display: grid; gap: 1rem;">
            <!-- Resources will be loaded here -->
        </div>

        <div id="no-resources-message" style="text-align: center; padding: 3rem 0; display: none;">
            <i data-lucide="folder" style="width: 4rem; height: 4rem; color: var(--muted-foreground); margin-bottom: 1rem;"></i>
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--foreground);">No Resources Yet</h3>
            <p style="color: var(--muted-foreground); margin-bottom: 1.5rem;">Start building your resource library!</p>
            <button class="btn btn-primary" onclick="showAddResourceModal()">Add First Resource</button>
        </div>
    </div>

    <!-- Add Resource Modal -->
    <div id="add-resource-modal" class="modal" style="display: none;">
        <div class="modal-content card" style="max-width: 500px; margin: 2rem auto; padding: 2rem;">
            <div class="card-header" style="text-align: center; margin-bottom: 1.5rem;">
                <h2 class="card-title">Add New Resource</h2>
                <p class="card-description">Add a link, document, or tool to your team's resource library</p>
            </div>
            <form id="add-resource-form" class="form">
                <div class="form-group">
                    <label for="resource-title">Title</label>
                    <input type="text" id="resource-title" placeholder="API Documentation" required>
                </div>
                <div class="form-group">
                    <label for="resource-description">Description</label>
                    <textarea id="resource-description" placeholder="Brief description of this resource" rows="3" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); resize: vertical; font-family: inherit;"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="resource-type">Type</label>
                        <select id="resource-type" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--background);">
                            <option value="link">Link/Reference</option>
                            <option value="document">Document</option>
                            <option value="tool">Tool/API</option>
                            <option value="media">Media/Asset</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="resource-category">Category</label>
                        <select id="resource-category" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--background);">
                            <option value="general">General</option>
                            <option value="development">Development</option>
                            <option value="design">Design</option>
                            <option value="research">Research</option>
                            <option value="documentation">Documentation</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="resource-url">URL</label>
                    <input type="url" id="resource-url" placeholder="https://example.com" required>
                </div>
                <div class="form-group">
                    <label for="resource-tags">Tags (comma-separated)</label>
                    <input type="text" id="resource-tags" placeholder="api, documentation, nodejs">
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-outline btn-full" onclick="hideAddResourceModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-full" id="add-resource-btn">
                        <span class="btn-text">Add Resource</span>
                        <span class="btn-loading hidden">Adding...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Resource Modal -->
    <div id="edit-resource-modal" class="modal" style="display: none;">
        <div class="modal-content card" style="max-width: 500px; margin: 2rem auto; padding: 2rem;">
            <div class="card-header" style="text-align: center; margin-bottom: 1.5rem;">
                <h2 class="card-title">Edit Resource</h2>
                <p class="card-description">Update resource details</p>
            </div>
            <form id="edit-resource-form" class="form">
                <input type="hidden" id="edit-resource-id">
                <div class="form-group">
                    <label for="edit-resource-title">Title</label>
                    <input type="text" id="edit-resource-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-resource-description">Description</label>
                    <textarea id="edit-resource-description" rows="3" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); resize: vertical; font-family: inherit;"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-resource-type">Type</label>
                        <select id="edit-resource-type" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--background);">
                            <option value="link">Link/Reference</option>
                            <option value="document">Document</option>
                            <option value="tool">Tool/API</option>
                            <option value="media">Media/Asset</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-resource-category">Category</label>
                        <select id="edit-resource-category" style="width: 100%; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: var(--radius); background: var(--background);">
                            <option value="general">General</option>
                            <option value="development">Development</option>
                            <option value="design">Design</option>
                            <option value="research">Research</option>
                            <option value="documentation">Documentation</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-resource-url">URL</label>
                    <input type="url" id="edit-resource-url" required>
                </div>
                <div class="form-group">
                    <label for="edit-resource-tags">Tags (comma-separated)</label>
                    <input type="text" id="edit-resource-tags">
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-outline btn-full" onclick="hideEditResourceModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-full">Update Resource</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Check authentication
        if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }

        let currentUser = JSON.parse(localStorage.getItem('user'));
        let currentTeam = null;
        let resources = [];
        let currentFilter = 'all';

        function getTeamId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('team');
        }

        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'index.html';
        }

        function loadTeamData() {
            const teamId = getTeamId();
            if (!teamId) {
                window.location.href = 'teams.html';
                return;
            }

            currentTeam = currentUser.teams?.find(t => t.id.toString() === teamId);
            if (!currentTeam) {
                window.location.href = 'teams.html';
                return;
            }

            // Update page elements
            document.getElementById('team-badge').textContent = currentTeam.name;

            // Initialize resources array if it doesn't exist
            if (!currentTeam.resources) {
                currentTeam.resources = generateSampleResources();
            }

            resources = currentTeam.resources;
            loadResources();
            updateResourceCounts();
        }

        function generateSampleResources() {
            return [
                {
                    id: '1',
                    title: 'React Documentation',
                    description: 'Official React.js documentation and guides',
                    type: 'link',
                    category: 'development',
                    url: 'https://reactjs.org/docs',
                    tags: ['react', 'documentation', 'frontend'],
                    addedBy: currentUser.email,
                    addedAt: new Date().toISOString()
                },
                {
                    id: '2',
                    title: 'Figma Design System',
                    description: 'Team design system and component library',
                    type: 'tool',
                    category: 'design',
                    url: 'https://figma.com/file/example',
                    tags: ['figma', 'design', 'ui', 'components'],
                    addedBy: currentUser.email,
                    addedAt: new Date().toISOString()
                },
                {
                    id: '3',
                    title: 'API Reference Guide',
                    description: 'RESTful API endpoints and authentication guide',
                    type: 'document',
                    category: 'documentation',
                    url: 'https://docs.example.com/api',
                    tags: ['api', 'rest', 'backend', 'authentication'],
                    addedBy: currentUser.email,
                    addedAt: new Date().toISOString()
                }
            ];
        }

        function updateResourceCounts() {
            const linkCount = resources.filter(r => r.type === 'link').length;
            const documentCount = resources.filter(r => r.type === 'document').length;
            const toolCount = resources.filter(r => r.type === 'tool').length;
            const mediaCount = resources.filter(r => r.type === 'media').length;

            document.getElementById('links-count').textContent = linkCount;
            document.getElementById('documents-count').textContent = documentCount;
            document.getElementById('tools-count').textContent = toolCount;
            document.getElementById('media-count').textContent = mediaCount;
        }

        function loadResources() {
            const resourcesGrid = document.getElementById('resources-grid');
            const noResourcesMessage = document.getElementById('no-resources-message');

            let filteredResources = resources;

            // Apply filters
            if (currentFilter !== 'all') {
                filteredResources = resources.filter(r => r.type === currentFilter);
            }

            if (resources.length === 0) {
                resourcesGrid.style.display = 'none';
                noResourcesMessage.style.display = 'block';
                return;
            }

            resourcesGrid.style.display = 'grid';
            noResourcesMessage.style.display = 'none';

            if (filteredResources.length === 0) {
                resourcesGrid.innerHTML = '<p style="text-align: center; color: var(--muted-foreground); padding: 2rem; grid-column: 1 / -1;">No resources match the current filter.</p>';
                return;
            }

            resourcesGrid.innerHTML = filteredResources.map(resource => {
                const addedBy = currentTeam.members?.find(m => m.email === resource.addedBy);
                const typeIcon = getResourceTypeIcon(resource.type);
                const typeColor = getResourceTypeColor(resource.type);

                return `
                    <div class="card resource-item" style="padding: 1.5rem; transition: all 0.2s; cursor: pointer;" onclick="openResource('${resource.url}')">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 2.5rem; height: 2.5rem; background: ${typeColor}; border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <i data-lucide="${typeIcon}" style="width: 1.25rem; height: 1.25rem; color: white;"></i>
                                </div>
                                <div>
                                    <h3 style="font-size: 1rem; font-weight: 600; margin: 0 0 0.25rem 0; color: var(--foreground);">${resource.title}</h3>
                                    <span class="badge" style="background: ${typeColor}; color: white; font-size: 0.75rem;">${resource.type}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-ghost" style="padding: 0.25rem;" onclick="event.stopPropagation(); editResource('${resource.id}')" title="Edit Resource">
                                    <i data-lucide="edit" style="width: 1rem; height: 1rem;"></i>
                                </button>
                                <button class="btn btn-ghost" style="padding: 0.25rem; color: var(--destructive);" onclick="event.stopPropagation(); deleteResource('${resource.id}')" title="Delete Resource">
                                    <i data-lucide="trash-2" style="width: 1rem; height: 1rem;"></i>
                                </button>
                            </div>
                        </div>
                        
                        ${resource.description ? `<p style="color: var(--muted-foreground); margin-bottom: 1rem; font-size: 0.875rem; line-height: 1.4;">${resource.description}</p>` : ''}
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; font-size: 0.875rem; color: var(--muted-foreground);">
                            <i data-lucide="link" style="width: 1rem; height: 1rem;"></i>
                            <span style="word-break: break-all;">${resource.url}</span>
                        </div>

                        ${resource.tags && resource.tags.length > 0 ? `
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                                ${resource.tags.map(tag => `
                                    <span style="background: var(--muted); color: var(--muted-foreground); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">#${tag}</span>
                                `).join('')}
                            </div>
                        ` : ''}

                        <div style="display: flex; align-items: center; justify-content: between; font-size: 0.875rem; color: var(--muted-foreground);">
                            <span>
                                <i data-lucide="user" style="width: 1rem; height: 1rem; margin-right: 0.25rem;"></i>
                                Added by ${addedBy ? addedBy.name : 'Unknown'}
                            </span>
                            <span style="margin-left: auto;">
                                <i data-lucide="calendar" style="width: 1rem; height: 1rem; margin-right: 0.25rem;"></i>
                                ${new Date(resource.addedAt).toLocaleDateString()}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');

            lucide.createIcons();
        }

        function getResourceTypeIcon(type) {
            switch (type) {
                case 'link': return 'link';
                case 'document': return 'file-text';
                case 'tool': return 'tool';
                case 'media': return 'image';
                default: return 'folder';
            }
        }

        function getResourceTypeColor(type) {
            switch (type) {
                case 'link': return 'var(--primary)';
                case 'document': return '#10B981';
                case 'tool': return '#F59E0B';
                case 'media': return '#8B5CF6';
                default: return 'var(--secondary)';
            }
        }

        function openResource(url) {
            window.open(url, '_blank');
        }

        function showAddResourceModal() {
            document.getElementById('add-resource-modal').style.display = 'block';
        }

        function hideAddResourceModal() {
            document.getElementById('add-resource-modal').style.display = 'none';
            document.getElementById('add-resource-form').reset();
        }

        function showEditResourceModal() {
            document.getElementById('edit-resource-modal').style.display = 'block';
        }

        function hideEditResourceModal() {
            document.getElementById('edit-resource-modal').style.display = 'none';
            document.getElementById('edit-resource-form').reset();
        }

        function editResource(resourceId) {
            const resource = resources.find(r => r.id === resourceId);
            if (!resource) return;

            document.getElementById('edit-resource-id').value = resource.id;
            document.getElementById('edit-resource-title').value = resource.title;
            document.getElementById('edit-resource-description').value = resource.description || '';
            document.getElementById('edit-resource-type').value = resource.type;
            document.getElementById('edit-resource-category').value = resource.category;
            document.getElementById('edit-resource-url').value = resource.url;
            document.getElementById('edit-resource-tags').value = resource.tags ? resource.tags.join(', ') : '';

            showEditResourceModal();
        }

        function deleteResource(resourceId) {
            if (confirm('Are you sure you want to delete this resource?')) {
                resources = resources.filter(r => r.id !== resourceId);
                currentTeam.resources = resources;
                saveTeamData();
                loadResources();
                updateResourceCounts();
            }
        }

        function saveTeamData() {
            currentUser.teams = currentUser.teams.map(team => 
                team.id === currentTeam.id ? currentTeam : team
            );
            localStorage.setItem('user', JSON.stringify(currentUser));
        }

        // Handle add resource form
        document.getElementById('add-resource-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const title = document.getElementById('resource-title').value;
            const description = document.getElementById('resource-description').value;
            const type = document.getElementById('resource-type').value;
            const category = document.getElementById('resource-category').value;
            const url = document.getElementById('resource-url').value;
            const tags = document.getElementById('resource-tags').value;
            const btn = document.getElementById('add-resource-btn');

            if (!title || !url) return;

            btn.classList.add('loading');
            btn.disabled = true;

            setTimeout(() => {
                const newResource = {
                    id: Date.now().toString(),
                    title: title,
                    description: description,
                    type: type,
                    category: category,
                    url: url,
                    tags: tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [],
                    addedBy: currentUser.email,
                    addedAt: new Date().toISOString()
                };

                resources.push(newResource);
                currentTeam.resources = resources;
                saveTeamData();

                hideAddResourceModal();
                loadResources();
                updateResourceCounts();

                btn.classList.remove('loading');
                btn.disabled = false;
            }, 500);
        });

        // Handle edit resource form
        document.getElementById('edit-resource-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const resourceId = document.getElementById('edit-resource-id').value;
            const resource = resources.find(r => r.id === resourceId);
            if (!resource) return;

            resource.title = document.getElementById('edit-resource-title').value;
            resource.description = document.getElementById('edit-resource-description').value;
            resource.type = document.getElementById('edit-resource-type').value;
            resource.category = document.getElementById('edit-resource-category').value;
            resource.url = document.getElementById('edit-resource-url').value;
            const tags = document.getElementById('edit-resource-tags').value;
            resource.tags = tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [];

            saveTeamData();
            hideEditResourceModal();
            loadResources();
            updateResourceCounts();
        });

        // Handle filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.filter;
                loadResources();
            });
        });

        // Load team data on page load
        loadTeamData();
    </script>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            max-height: 90vh;
            overflow-y: auto;
        }

        .filter-btn.active {
            background: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }

        .resource-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        #resources-grid {
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }

        @media (max-width: 768px) {
            #resources-grid {
                grid-template-columns: 1fr !important;
            }
            
            .form-row {
                grid-template-columns: 1fr !important;
            }
            
            .modal-content {
                width: 95% !important;
                margin: 1rem auto !important;
            }
        }
    </style>
</body>
</html>
